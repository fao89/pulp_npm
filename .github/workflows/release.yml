# WARNING: DO NOT EDIT!
#
# This file was generated by plugin_template, and is managed by it. Please use
# './plugin-template --github pulp_npm' to update this file.
#
# For more info visit https://github.com/pulp/plugin_template
---
name: Pulp Release CI/CD
on:
  push:
    tags:
      - '*'

jobs:
  test:
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        env:
          - TEST: pulp
          - TEST: docs
          - TEST: s3

    steps:
      - uses: actions/checkout@v2
        with:
          # by default, it uses a depth of 1
          # this fetches all history so that we can read each commit
          fetch-depth: 0

      - uses: actions/setup-python@v2
        with:
          python-version: "3.7"

      - name: Dispatching
        run: |
          echo "{\"ref\": \"${GITHUB_REF##*/}\", \"inputs\": {\"pulpTestType\": \"${{ matrix.env.TEST }}\"}}" > data.json
          cat data.json
          curl \
            -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: Bearer ${GITHUB_TOKEN}" \
            https://api.github.com/repos/pulp/pulp_npm/actions/workflows/dispatch.yml/dispatches \
            -d @data.json
        env:
          GITHUB_TOKEN: ${{ secrets.GIT_POC_SECRET }}
